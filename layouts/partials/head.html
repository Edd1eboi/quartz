<head>
    <!-- Meta tags -->
    <meta charset="UTF-8">
    <meta name="description" content="{{$.Site.Data.config.description}}">
    <title>{{ if .Title }}{{ .Title }}{{ else }}{{ $.Site.Data.config.page_title }}{{ end }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/png" href="/icon.png" />

    <!-- CSS Stylesheets and Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Source+Sans+Pro:wght@400;700&family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://github.com/Edd1ee/quartz/blob/hugo/pso2_font/pso2_font.ttf" rel="stylesheet">
    {{ $css := slice "custom.scss" "base.scss" "darkmode.scss" "syntax.scss"}}
    {{range $css}}
    {{$sass := resources.Get . | resources.ToCSS }}
    {{with $sass | minify}}
    <style>
        {{.Content | safeCSS}}
    </style>
    {{end}}
    {{end}}

    {{- with resources.Get "darkmode.js" | minify -}}
    <script>
      {{.Content | safeJS }}
    </script>
    {{- end -}}

<!-- Absolutely losing it. -->

<script>

    var config = {
      iteration: 0,
      canvas: {
        width: Math.max(960, innerWidth),
        height: Math.max(500, innerHeight)
      },
      circle: {
        radius: 30,
        duration: 1000,
        lineWidth: 1,
        ease:  function (t) {
          var n = 1 / 2;
          return Math.abs(Math.sin(t * Math.PI));
        },
        wiggle: 0
      },
      color: {
        hue: function (iteration) {
          return 6 * iteration % 360;
        },
        saturation: 1,
        lightness: 0.5,
        compositeType: 'lighter'
      },
    };

    var x1 = config.canvas.width / 2;
    var y1 = config.canvas.height / 2;

    console.log(y1)
    var x0 = x1;
    var y0 = y1;
    var tao = 2 * Math.PI;

    var canvas = d3.select("body").append("canvas")
    .attr("width", config.canvas.width)
    .attr("height", config.canvas.height)
    .on("ontouchstart" in document ? "touchmove" : "mousemove", move);

    var context = canvas.node().getContext("2d");
    context.globalCompositeOperation = config.compositeType;
    context.lineWidth = config.circle.lineWidth;

    d3.timer(function() {
      context.clearRect(0, 0, config.canvas.width, config.canvas.height);

      var color = d3.hsl(
        config.color.hue(config.iteration),
        config.color.saturation,
        config.color.lightness
      ).rgb();

      var x = x0 += (x1 - x0) * 0.1;
      var y = y0 += (y1 - y0) * 0.1;

      d3.select({}).transition()
      .duration(config.circle.duration)
      .ease(config.circle.ease)
      .tween("circle", function() {
        return function(t) {
          // t is what percent of the easing is done
          context.strokeStyle = "rgba(" + color.r + "," + color.g + "," + color.b + "," + (1 - t) + ")";
          context.beginPath();
          context.arc(x, y, config.circle.radius * t, 0, tao);
          context.stroke();
        };
      });

      config.iteration++;
    });

    function move() {
      var mouse = d3.mouse(this);
      x1 = mouse[0];
      y1 = mouse[1];
      d3.event.preventDefault();
    }

  </script>


</head>
{{ template "_internal/google_analytics.html" . }}
